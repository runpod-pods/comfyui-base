# Contributing

Thanks for your interest in contributing! This repository builds a compact, production-ready ComfyUI container optimized for RunPod.

## Releases

This repository uses GitHub Actions to build and publish Docker images to Docker Hub. No local builds are required for contributors.

Prerequisites (repository secrets set once):

- `DOCKERHUB_USERNAME`
- `DOCKERHUB_TOKEN` (Docker Hub access token)

Create a new release of the image:

1. Choose a version (semantic, e.g., `vX.Y.Z`).
2. Create the release by either:
   - Pushing a tag: `git tag vX.Y.Z && git push origin vX.Y.Z`, or
   - Publishing a GitHub Release with tag `vX.Y.Z`, or
   - Manually running the “Release” workflow and providing `version = vX.Y.Z`.
3. The “Release” workflow will build and push both image variants via `docker-bake.hcl`:
   - `runpod/comfyui:vX.Y.Z` and `runpod/comfyui:latest`
   - `runpod/comfyui:vX.Y.Z-5090` and `runpod/comfyui:latest-5090`

Notes:

- Tags are defined in `docker-bake.hcl`. Do not override tags in the workflow.
- Stack details and ports: see `docs/conventions.md`.

Troubleshooting releases:

- If the workflow fails on tags, ensure you didn’t try to override `tags` via bake `--set`.
- Confirm Docker Hub secrets exist and have push permissions to `runpod/comfyui`.

## Release process

Releases are tag-driven and/or GitHub Releases. The workflow builds and pushes both variants:

- `runpod/comfyui:vX.Y.Z` and `runpod/comfyui:latest`
- `runpod/comfyui:vX.Y.Z-5090` and `runpod/comfyui:latest-5090`

Steps:

1. Ensure repository secrets exist:
   - `DOCKERHUB_USERNAME`
   - `DOCKERHUB_TOKEN` (Docker Hub access token)
2. Create a version tag or a GitHub Release:
   - Tag push: `git tag vX.Y.Z && git push origin vX.Y.Z`
   - OR GitHub Release: publish a release with tag `vX.Y.Z` (or use the “Release” workflow’s manual input `version`)
3. The workflow will:
   - Build `regular` and `rtx5090` using `docker-bake.hcl`
   - Push versioned and `latest` tags for both variants
   - Create or use the GitHub Release entry with autogenerated notes

Troubleshooting:

- Do not override `tags` in the workflow; they are defined in `docker-bake.hcl`.
- Use the “Dev Build” workflow to test changes without tagging.
- Check container logs under `/workspace/runpod-slim/*.log` if runtime issues occur.

## Opening PRs

- Keep changes focused and include a clear rationale.
- Update `docs/conventions.md` if you change behavior that developers rely on.

## License

- GPLv3. By contributing, you agree your changes are licensed under GPLv3.
